name: Delete Old Articles Only
on:
  workflow_dispatch:
    inputs:
      force_cleanup:
        description: 'Force cleanup of old articles'
        required: false
        default: 'true'
        type: boolean

jobs:
  cleanup-old-articles:
    runs-on: ubuntu-latest
    steps:
      - name: Cleanup old articles
        id: cleanup
        run: |
          echo "🧹 Starting cleanup of old articles..."
          echo "📅 Current time: $(date)"
          
          # Call the cleanup endpoint
          CLEANUP_RESPONSE=$(curl -s -w "%{http_code}" -o cleanup_response.json -X POST "https://effortless-connection-2f75f4ee80.strapiapp.com/api/delete-old-articles" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.STRAPI_API_TOKEN }}")
          
          echo "📊 Cleanup HTTP Status: $CLEANUP_RESPONSE"
          echo "📄 Cleanup Response Details:"
          cat cleanup_response.json
          echo ""
          
          # Check response
          if [ "$CLEANUP_RESPONSE" -eq 200 ] || [ "$CLEANUP_RESPONSE" -eq 207 ]; then
            echo "✅ Cleanup completed successfully"
          else
            echo "⚠️ Cleanup failed with status $CLEANUP_RESPONSE"
            echo "🔍 Cleanup response details:"
            cat cleanup_response.json
            exit 1
          fi
          
          echo "🧹 Cleanup finished at: $(date)"
